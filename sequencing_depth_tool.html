<head>
<meta charset="UTF-8">
<title>Metagenomic Coverage Calculator</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 40px;
    max-width: 900px;
  }

  h1 { margin-bottom: 5px; }
  h2 { margin-top: 40px; }
  label { display: block; margin-top: 10px; }
  input { width: 120px; padding: 5px; margin-left: 10px; }
  button { margin-top: 15px; padding: 8px 14px; cursor: pointer; }

  /* Toggle buttons */
  .toggle-container {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
  }
  .toggle-btn {
    padding: 8px 16px;
    border: 2px solid #888;
    background: #f0f0f0;
    cursor: pointer;
    font-weight: bold;
    border-radius: 6px;
  }
  .toggle-btn.active {
    background: #4a90e2;
    color: white;
    border-color: #2c6bb2;
  }

  /* Controls block inside cheat sheet */
  .table-controls {
    margin-top: 10px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 30px;
  }

  /* Compact slider */
  .slider-container {
    width: 260px;
  }
  .slider-labels {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    opacity: 0.85;
    margin-top: 4px;
  }
  input[type="range"] {
    width: 100%;
  }

  /* Tables */
  table {
    border-collapse: collapse;
    margin-top: 20px;
    width: 100%;
  }
  th, td {
    border: 1px solid #aaa;
    padding: 6px;
    text-align: center;
  }
  th { background: #eee; }

  /* Color palette */
  .color-taxonomy { background-color: #e3d7ff; }
  .color-functional { background-color: #d0ecff; }
  .color-highres { background-color: #bfe8ff; }
  .color-mag { background-color: #ffe2cc; }
  .color-low { background-color: #ffffff; }

  /* Scroll container */
  .scroll-table {
    overflow-x: auto;
    margin-top: 15px;
  }

  /* Legend */
  .legend-box {
    margin-top: 10px;
    padding: 12px;
    border: 1px solid #aaa;
    background: #fafafa;
    font-size: 14px;
  }
  .legend-title {
    font-weight: bold;
    margin-bottom: 10px;   /* Added spacing */
  }
  .legend-item {
    display: flex;
    align-items: center;
    margin-top: 8px;       /* Added breathing room */
  }
  .legend-color {
    width: 18px;
    height: 18px;
    margin-right: 8px;
    border: 1px solid #666;
  }

  /* Recommended depth tables */
  .depth-cheatsheet {
    width: 100%;
    border-collapse: collapse;
    margin-top: 30px;
  }
  .depth-cheatsheet th, .depth-cheatsheet td {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: left;
  }
  .depth-cheatsheet th {
    background-color: #eee;
    font-weight: bold;
  }
  .depth-cheatsheet caption {
    margin-bottom: 10px;
    font-size: 20px;
    font-weight: bold;
  }

  /* Hide rumen table initially */
</style>
</head>

<body>

<h1>Metagenomic Coverage Calculator</h1>

<!-- ============================
     COVERAGE FROM DEPTH
     ============================ -->
<h2>Coverage From Sequencing Depth</h2>

<label>
  Relative abundance (%):
  <input id="abundance" type="number" value="1" step="0.01">
</label>

<label>
  Genome size (Mb):
  <input id="genome" type="number" value="4" step="0.1">
</label>

<label>
  Sequencing depth (Gb):
  <input id="depth" type="number" value="10" step="0.1">
</label>

<button onclick="computeCoverage()">Compute Coverage</button>

<p id="coverageResult" style="font-weight:bold;"></p>

<!-- ============================
     REQUIRED DEPTH CALCULATOR
     ============================ -->
<h2>Required Sequencing Depth for Target Coverage</h2>

<label>
  Target coverage (×):
  <input id="targetCoverage" type="number" value="10" step="0.1">
</label>

<label>
  Relative abundance (%):
  <input id="abundance2" type="number" value="1" step="0.01">
</label>

<label>
  Genome size (Mb):
  <input id="genome2" type="number" value="4" step="0.1">
</label>

<button onclick="computeRequiredDepth()">Compute Required Depth</button>

<p id="depthResult" style="font-weight:bold;"></p>

<!-- ============================
     CHEAT SHEET SECTION (header only)
     ============================ -->
<h2>Cheat Sheet: Coverage Across Depths and Relative Abundances</h2>
<p>Automatically updates with ecosystem mode, DNA quality, and genome size.</p>

<!-- ============================
     CHEAT SHEET CONTROLS (L2 placement)
     ============================ -->
<div class="table-controls">

  <!-- Ecosystem toggle -->
  <div class="toggle-container">
    <button id="btnHuman" class="toggle-btn active" onclick="setEcosystem('human')">Human Gut</button>
    <button id="btnRumen" class="toggle-btn" onclick="setEcosystem('rumen')">Rumen</button>
  </div>

  <!-- DNA quality slider (flipped, with ng thresholds + tooltips) -->
  <div class="slider-container">
    <label><strong>DNA Quality:</strong></label>

    <!-- Slider is reversed visually: 0 = Very Low, 3 = High -->
    <input type="range" id="dnaSlider" min="0" max="3" step="1" value="3" oninput="updateAll()">

    <div class="slider-labels">
      <span title="<1 ng — unstable, high PCR cycles">Very Low<br>&lt;1 ng</span>
      <span title="1–9.9 ng — high PCR cycles, e.g., 1.3 ng">Low<br>1–9.9 ng</span>
      <span title="10–99 ng — moderate PCR cycles">Moderate<br>10–99 ng</span>
      <span title="≥100 ng — low PCR cycles, stable profiles">High<br>≥100 ng</span>
    </div>
  </div>

</div>

<!-- Genome size input -->
<label>
  Genome size (Mb):
  <input id="genomeCheat" type="number" value="4" step="0.1" oninput="updateAll()">
</label>

<!-- ============================
     EXTENDED DYNAMIC TABLE
     ============================ -->
<div class="scroll-table">
  <table id="cheatTable">
    <thead>
      <tr>
        <th>Depth (Gb)</th>
        <th>RA 100%</th>
        <th>RA 90%</th>
        <th>RA 80%</th>
        <th>RA 70%</th>
        <th>RA 60%</th>
        <th>RA 50%</th>
        <th>RA 40%</th>
        <th>RA 30%</th>
        <th>RA 20%</th>
        <th>RA 10%</th>
        <th>RA 1%</th>
        <th>RA 0.1%</th>
        <th>RA 0.01%</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- ============================
     UPDATED LEGEND (with spacing + “Ideal for…”)
     ============================ -->
<div id="legendBox" class="legend-box">
  <div class="legend-title">Coverage Tiers</div>

  <div class="legend-item">
    <div class="legend-color" style="background:#e3d7ff;"></div>
    Ideal for Taxonomic Profiling
  </div>

  <div class="legend-item">
    <div class="legend-color" style="background:#d0ecff;"></div>
    Ideal for Functional Profiling
  </div>

  <div class="legend-item">
    <div class="legend-color" style="background:#bfe8ff;"></div>
    Ideal for High‑Resolution Functional Profiling
  </div>

  <div class="legend-item">
    <div class="legend-color" style="background:#ffe2cc;"></div>
    Ideal for MAG Creation
  </div>

  <div class="legend-item">
    <div class="legend-color" style="background:#ffffff;"></div>
    Below Recommended Threshold
  </div>
</div>

<!-- ============================
     RECOMMENDED DEPTH TABLES
     ============================ -->

<!-- HUMAN GUT TABLE -->
<table id="humanDepthTable" class="depth-cheatsheet">
  <caption><strong>Recommended Depths — Human Gut</strong></caption>
  <tr>
    <th>Depth (Gbp)</th>
    <th>Use Case</th>
    <th>Coverage (2 Mbp genome)</th>
    <th>Coverage (3.5 Mbp genome)</th>
    <th>Analytical Capabilities</th>
  </tr>

  <tr class="color-taxonomy">
    <td>0.5–2 Gbp</td>
    <td><strong>Taxonomic Profiling</strong></td>
    <td>~250×</td>
    <td>~140×</td>
    <td>Stable species-level profiles; rare taxa may be missed.</td>
  </tr>

  <tr class="color-functional">
    <td>5 Gbp</td>
    <td><strong>Functional Profiling</strong></td>
    <td>~2,500×</td>
    <td>~1,400×</td>
    <td>High pathway completeness; moderate rare gene recovery.</td>
  </tr>

  <tr class="color-highres">
    <td>10 Gbp</td>
    <td><strong>High-Resolution Functional</strong></td>
    <td>≥10,000×</td>
    <td>≥5,700×</td>
    <td>Improved rare gene and protein detection.</td>
  </tr>

  <tr class="color-mag">
    <td>20–50+ Gbp</td>
    <td><strong>MAG Creation</strong></td>
    <td>≥20,000×</td>
    <td>≥11,400×</td>
    <td>Medium- to high-quality MAGs; deeper sequencing improves completeness.</td>
  </tr>
</table>




<!-- RUMEN TABLE -->
<table id="rumenDepthTable" class="depth-cheatsheet">
  <caption><strong>Recommended Depths — Rumen</strong></caption>
  <tr>
    <th>Depth (Gbp)</th>
    <th>Use Case</th>
    <th>Coverage (3.5 Mbp genome)</th>
    <th>Analytical Capabilities</th>
  </tr>

  <tr class="color-taxonomy">
    <td>5–10 Gbp</td>
    <td><strong>Taxonomic Profiling</strong></td>
    <td>~140×</td>
    <td>Stable genus-level profiles; species-level less stable.</td>
  </tr>

  <tr class="color-functional">
    <td>10–20 Gbp</td>
    <td><strong>Functional Profiling</strong></td>
    <td>~1,400×</td>
    <td>Improved pathway completeness; moderate rare gene recovery.</td>
  </tr>

  <tr class="color-highres">
    <td>20–40 Gbp</td>
    <td><strong>High-Resolution Functional</strong></td>
    <td>~5,700×</td>
    <td>High pathway completeness; better rare gene detection.</td>
  </tr>

  <tr class="color-mag">
    <td>40–80+ Gbp</td>
    <td><strong>MAG Creation</strong></td>
    <td>≥11,000×</td>
    <td>Required for medium- to high-quality MAGs in high-diversity rumen samples.</td>
  </tr>
</table>

<div style="margin-top:40px; padding:20px; border:2px solid #888; background:#f0f8ff;">
  <h2>Minimum Relative Abundance Required</h2>
  <p>
    When the relative abundance of a species is unknown, you can estimate the minimum abundance
    required to achieve a desired coverage given a specific sequencing depth and genome size.
    This is useful for planning sequencing depth when targeting low-abundance organisms.
  </p>

  <label>
    Target coverage (×):
    <input id="targetCoverageRA" type="number" value="5" step="0.1">
  </label>

  <label>
    Genome size (Mb):
    <input id="genomeRA" type="number" value="4" step="0.1">
  </label>

  <label>
    Sequencing depth (Gb):
    <input id="depthRA" type="number" value="10" step="0.1">
  </label>

  <button onclick="computeRequiredRA()">Compute Minimum RA</button>

  <p id="raResult" style="font-weight:bold;"></p>

  <h3>Scientific Basis</h3>
  <p>
    This calculation is derived by rearranging the standard sequencing coverage equation:
  </p>

  <pre style="background:#eee; padding:10px;">
Coverage = (D × 1000 × A) / G
A = (Coverage × G) / (1000 × D)
  </pre>

  <p>
    This inverse form is widely used in metagenomic study design to determine the minimum
    abundance at which a genome can be assembled or profiled at a given sequencing depth.
  </p>
</div>

<!-- ============================
     EXPLANATION & REFERENCES BOX
     ============================ -->
<div style="margin-top:40px; padding:20px; border:2px solid #888; background:#f7f7f7;">
  <h2>How These Calculations Work</h2>

  <p><strong>1. Bases sequenced for the species</strong><br>
     Total sequencing depth is measured in gigabases (Gb), where 1 Gb = 10<sup>9</sup> bases.
     If a species has relative abundance A (e.g., 1% = 0.01), then the number of bases
     sequenced for that species is:
  </p>

  <pre style="background:#eee; padding:10px;">
Species bases = D × 10⁹ × A
  </pre>

  <p><strong>2. Genome size conversion</strong><br>
     Genome size G is entered in megabases (Mb), where 1 Mb = 10<sup>6</sup> bases.
  </p>

  <pre style="background:#eee; padding:10px;">
Genome bases = G × 10⁶
  </pre>

  <p><strong>3. Coverage formula</strong><br>
     Coverage is defined as the number of sequenced bases divided by the genome size:
  </p>

  <pre style="background:#eee; padding:10px;">
Coverage = (D × 10⁹ × A) / (G × 10⁶)
         = (D × 1000 × A) / G
  </pre>

  <p>This is the standard definition of sequencing coverage used in genomics and metagenomics.</p>

  <p><strong>4. Required sequencing depth for a target coverage</strong><br>
     Rearranging the coverage formula gives:
  </p>

  <pre style="background:#eee; padding:10px;">
Required depth (Gb) = (Coverage × G) / (1000 × A)
  </pre>

  <p>This is commonly used in metagenomic sampling‑depth calculations for MAG recovery.</p>


  <!-- ============================
       GROUPED REFERENCES
       ============================ -->
  <h2>References</h2>

  <!-- COVERAGE THEORY -->
  <h3>Coverage Theory & Sequencing Mathematics</h3>
  <ul>
    <li>
      Lander, E. S., & Waterman, M. S. (1988). Genomic mapping by fingerprinting random clones:
      A mathematical analysis. <em>Genomics, 2</em>(3), 231–239.
      https://doi.org/10.1016/0888-7543(88)90007-9
    </li>
  </ul>

  <!-- METAGENOMIC COVERAGE, ABUNDANCE, GENOME SIZE -->
  <h3>Metagenomic Coverage, Genome Size, and Abundance Relationships</h3>
  <ul>
    <li>
      Nayfach, S., & Pollard, K. S. (2016). Average genome size estimation improves comparative
      metagenomics and sheds light on the functional ecology of the human microbiome.
      <em>Genome Biology, 16</em>, 51.
      https://pmc.ncbi.nlm.nih.gov/articles/PMC4389708/
    </li>
    <li>
      Nayfach, S., & Pollard, K. S. (2016). Toward accurate and quantitative comparative metagenomics.
      <em>Cell, 166</em>(5), 1103–1116.
      https://doi.org/10.1016/j.cell.2016.08.007
    </li>
  </ul>

  <!-- HUMAN GUT MICROBIOME & LARGE-SCALE CATALOGS -->
  <h3>Human Gut Microbiome & Large‑Scale Metagenomic Catalogs</h3>
  <ul>
    <li>
      Qin, J., Li, R., Raes, J., et al. (2010). A human gut microbial gene catalogue established by
      metagenomic sequencing. <em>Nature, 464</em>(7285), 59–65.
      https://doi.org/10.1038/nature08821
    </li>
    <li>
      Huttenhower, C., Gevers, D., Knight, R., et al. (2012). Structure, function and diversity of the
      healthy human microbiome. <em>Nature, 486</em>(7402), 207–214.
      https://doi.org/10.1038/nature11234
    </li>
    <li>
      Almeida, A., Nayfach, S., Boland, M., et al. (2021). A unified catalog of 204,938 reference genomes
      from the human gut microbiome. <em>Nature Biotechnology, 39</em>(1), 105–114.
      https://doi.org/10.1038/s41587-020-0603-3
    </li>
    <li>
      Almeida, A., Mitchell, A. L., Boland, M., et al. (2019). A new genomic blueprint of the human gut
      microbiota. <em>Nature, 568</em>(7753), 499–504.
      https://doi.org/10.1038/s41586-019-0965-1
    </li>
  </ul>

  <!-- MAG RECOVERY & ASSEMBLY -->
  <h3>MAG Recovery, Assembly, and Coverage Requirements</h3>
  <ul>
    <li>
      Parks, D. H., Rinke, C., Chuvochina, M., et al. (2017). Recovery of nearly 8,000 metagenome‑assembled
      genomes substantially expands the tree of life. <em>Nature Microbiology, 2</em>, 1533–1542.
      https://doi.org/10.1038/s41564-017-0012-7
    </li>
    <li>
      Nielsen, H. B., Almeida, M., Juncker, A. S., et al. (2014). Identification and assembly of genomes
      and genetic elements in complex metagenomic samples without using reference genomes.
      <em>Nature Biotechnology, 32</em>(8), 822–828.
      https://doi.org/10.1038/nbt.2939
    </li>
    <li>
      Stewart, R. D., Auffret, M. D., Warr, A., et al. (2018). Assembly of 913 microbial genomes from
      metagenomic sequencing of the cow rumen. <em>Nature Communications, 9</em>(1), 870.
      https://doi.org/10.1038/s41467-018-03317-6
    </li>
    <li>
      Seshadri, R., Leahy, S. C., Attwood, G. T., et al. (2018). Cultivation and sequencing of rumen
      microbiome members from the Hungate1000 Collection. <em>Nature Biotechnology, 36</em>(4), 359–367.
      https://doi.org/10.1038/nbt.4110
    </li>
  </ul>

  <!-- SHALLOW SHOTGUN & DEPTH BENCHMARKING -->
  <h3>Shallow Shotgun Sequencing, Depth Benchmarking, and Protocol Evaluation</h3>
  <ul>
    <li>
      Treichel, N. S., Pauvert, C., Séneca, J., et al. (2026). Benchmarking of shotgun sequencing depth
      highlights limitations of strain‑level analysis and shallow metagenomics.
      <em>bioRxiv</em>. https://doi.org/10.1101/2025.03.27.645659
    </li>
    <li>
      Yu, K. H. O., Fang, X., Yao, H., et al. (2022). Evaluation of experimental protocols for shotgun
      whole‑genome metagenomic discovery of antibiotic resistance genes.
      <em>IEEE/ACM Transactions on Computational Biology and Bioinformatics, 19</em>(3), 1313–1321.
      https://doi.org/10.1109/TCBB.2020.3004063
    </li>
    <li>
      Tremblay, J., Schreiber, L., & Greer, C. W. (2022). High‑resolution shotgun metagenomics:
      The more data, the better? <em>Briefings in Bioinformatics, 23</em>(6), bbac443.
      https://doi.org/10.1093/bib/bbac443
    </li>
    <li>
      Gaulke, C. A., Schmeltzer, E. R., Dasenko, M., et al. (2021). Evaluation of the effects of library
      preparation procedure and sample characteristics on the accuracy of metagenomic profiles.
      <em>mSystems, 6</em>(5). https://doi.org/10.1128/msystems.00440-21
    </li>
    <li>
      Xu, W., Chen, T., Pei, Y., et al. (2021). Characterization of shallow whole‑metagenome shotgun
      sequencing as a high‑accuracy and low‑cost method by complicated mock microbiomes.
      <em>Frontiers in Microbiology, 12</em>, 678319.
      https://doi.org/10.3389/fmicb.2021.678319
    </li>
    <li>
      Hillmann, B., Al‑Ghalith, G. A., Shields‑Cutler, R. R., et al. (2018). Evaluating the information
      content of shallow shotgun metagenomics. <em>mSystems, 3</em>(6).
      https://doi.org/10.1128/msystems.00069-18
    </li>
    <li>
      Cheng, W. Y., Liu, W. X., Ding, Y., et al. (2023). High sensitivity of shotgun metagenomic sequencing
      in colon tissue biopsy by host DNA depletion. <em>Genomics, Proteomics & Bioinformatics, 21</em>(6),
      1195–1205. https://doi.org/10.1016/j.gpb.2022.09
    </li>
  </ul>

  <p>
    These papers collectively support the mathematical definitions of coverage, the relationship
    between sequencing depth and relative abundance, and the empirical coverage thresholds used
    for MAG recovery, pathway inference, and taxonomic profiling.
  </p>
</div>


<script>
/* ============================================================
   GLOBAL SETTINGS
   ============================================================ */
let settings = {
  ecosystem: "human",
  dnaQuality: 3   // slider default = High DNA quality
};

/* ============================================================
   ECOSYSTEM THRESHOLDS
   ============================================================ */
const thresholds = {
  human: { taxonomy: 250, functional: 2500, highres: 10000, mag: 20000 },
  rumen: { taxonomy: 140, functional: 1400, highres: 5700, mag: 11000 }
};

/* ============================================================
   DEPTH TIERS
   ============================================================ */
const depthTiers = {
  human: [0.5, 1, 2, 5, 10, 20, 50],
  rumen: [5, 10, 20, 40, 80]
};

/* ============================================================
   DNA QUALITY MULTIPLIERS (scientifically correct)
   slider: 0 = Very Low → 3 = High
   ============================================================ */
const dnaMultipliers = [
  3.0,  // Very Low (<1 ng)
  4.0,  // Low (1–9.9 ng)
  6.0,  // Moderate (10–99 ng)
 9.0   // High (≥100 ng)
];

/* ============================================================
   ECOSYSTEM TOGGLE
   ============================================================ */
function setEcosystem(mode) {
  settings.ecosystem = mode;

  document.getElementById("btnHuman").classList.toggle("active", mode === "human");
  document.getElementById("btnRumen").classList.toggle("active", mode === "rumen");

  document.getElementById("humanDepthTable").style.display = mode === "human" ? "table" : "none";
  document.getElementById("rumenDepthTable").style.display = mode === "rumen" ? "table" : "none";

  updateAll();
}

/* ============================================================
   COLOR CODING
   ============================================================ */
function getColorClass(cov) {
  const G = parseFloat(document.getElementById('genomeCheat').value) || 2;

  // Choose threshold set based on genome size: 2 Mbp vs 3.5 Mbp
  let t;
  if (G <= 2.25) {
    // 2 Mbp thresholds
    t = { taxonomy: 250, functional: 2500, highres: 10000, mag: 20000 };
  } else {
    // 3.5 Mbp thresholds
    t = { taxonomy: 140, functional: 1400, highres: 5700, mag: 11400 };
  }

  if (cov >= t.mag) return "color-mag";
  if (cov >= t.highres) return "color-highres";
  if (cov >= t.functional) return "color-functional";
  if (cov >= t.taxonomy) return "color-taxonomy";
  return "color-low";
}



/* ============================================================
   LEGEND UPDATE
   ============================================================ */
function updateLegend() {
  document.getElementById("legendBox").innerHTML = `
    <div class="legend-title">Coverage Tiers</div>

    <div class="legend-item">
      <div class="legend-color" style="background:#e3d7ff;"></div>
      Ideal for Taxonomic Profiling
    </div>

    <div class="legend-item">
      <div class="legend-color" style="background:#d0ecff;"></div>
      Ideal for Functional Profiling
    </div>

    <div class="legend-item">
      <div class="legend-color" style="background:#bfe8ff;"></div>
      Ideal for High‑Resolution Functional Profiling
    </div>

    <div class="legend-item">
      <div class="legend-color" style="background:#ffe2cc;"></div>
      Ideal for MAG Creation
    </div>

    <div class="legend-item">
      <div class="legend-color" style="background:#ffffff;"></div>
      Below Recommended Threshold
    </div>
  `;
}

/* ============================================================
   EXTENDED DYNAMIC TABLE
   ============================================================ */
function updateCheatSheet() {
  const G = parseFloat(document.getElementById('genomeCheat').value) || 1;
  const multiplier = dnaMultipliers[parseInt(document.getElementById('dnaSlider').value, 10)];
  settings.dnaQuality = parseInt(document.getElementById('dnaSlider').value, 10);

  const depths = depthTiers[settings.ecosystem];
  const abundances = [1,0.9,0.8,0.7,0.6,0.5,0.4,0.3,0.2,0.1,0.01,0.001,0.0001];

  const tbody = document.querySelector('#cheatTable tbody');
  tbody.innerHTML = "";

  depths.forEach(D => {
    const row = document.createElement('tr');

    const depthCell = document.createElement('td');
    depthCell.textContent = D;
    row.appendChild(depthCell);

    abundances.forEach(A => {
      const cov = (D * multiplier * 1000 * A) / G;
      const cell = document.createElement('td');
      cell.textContent = cov.toFixed(2) + "×";
      cell.className = getColorClass(cov);
      row.appendChild(cell);
    });

    tbody.appendChild(row);
  });
}

/* ============================================================
   COVERAGE CALCULATOR
   ============================================================ */
function computeCoverage() {
  const A = parseFloat(document.getElementById('abundance').value) / 100.0;
  const G = parseFloat(document.getElementById('genome').value) || 1;
  const D = parseFloat(document.getElementById('depth').value) || 0;
  const multiplier = dnaMultipliers[parseInt(document.getElementById('dnaSlider').value, 10)];

  const coverage = (D * multiplier * 1000 * A) / G;

  document.getElementById('coverageResult').innerText =
    `Estimated coverage (with DNA-quality adjustment): ${coverage.toFixed(2)}×`;
}

/* ============================================================
   REQUIRED DEPTH CALCULATOR
   ============================================================ */
function computeRequiredDepth() {
  const C = parseFloat(document.getElementById('targetCoverage').value) || 0;
  const A = parseFloat(document.getElementById('abundance2').value) / 100.0;
  const G = parseFloat(document.getElementById('genome2').value) || 1;
  const multiplier = dnaMultipliers[parseInt(document.getElementById('dnaSlider').value, 10)];

  const depthGb = (C * G) / (1000 * A * multiplier);

  document.getElementById('depthResult').innerText =
    `Required sequencing depth (adjusted for DNA quality): ${depthGb.toFixed(2)} Gb`;
}

/* ============================================================
   MINIMUM RELATIVE ABUNDANCE CALCULATOR
   ============================================================ */
function computeRequiredRA() {
  const C = parseFloat(document.getElementById('targetCoverageRA').value) || 0;
  const G = parseFloat(document.getElementById('genomeRA').value) || 1;
  const D = parseFloat(document.getElementById('depthRA').value) || 0;
  const multiplier = dnaMultipliers[parseInt(document.getElementById('dnaSlider').value, 10)];

  const A = (C * G) / (1000 * D * multiplier);
  const A_percent = A * 100;

  document.getElementById('raResult').innerText =
    `Minimum relative abundance required (adjusted for DNA quality): ${A_percent.toFixed(4)}%`;
}

/* ============================================================
   UPDATE EVERYTHING
   ============================================================ */
function updateAll() {
  updateLegend();
  updateCheatSheet();
}

/* ============================================================
   INITIALIZE ON LOAD
   ============================================================ */
updateAll();
</script>
